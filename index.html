<!-- index.html -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Farming CBA Decision Tool 2</title>
  <meta name="description" content="Excel-first farm cost‚Äìbenefit analysis tool with control vs treatments comparison." />
  <link rel="stylesheet" href="./styles.css" />

  <!-- Optional libs (used by app.js if present) -->
  <!-- SheetJS for Excel import/export -->
  <script defer src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</head>

<body>
  <a class="skip-link" href="#main">Skip to content</a>

  <div id="app" class="app">
    <header class="topbar">
      <div class="topbar__left">
        <div class="brand">
          <div class="brand__mark" aria-hidden="true">CBA</div>
          <div class="brand__text">
            <div class="brand__title">Farming CBA Decision Tool 2</div>
            <div class="brand__subtitle">Control vs treatments, Excel-first workflow</div>
          </div>
        </div>
      </div>

      <div class="topbar__right">
        <div class="chip" id="dataStateChip" title="Data status">
          <span class="dot" aria-hidden="true"></span>
          <span id="dataStateText">Data loaded</span>
        </div>

        <button class="btn btn--ghost" id="copyResultsBtnTop" type="button" title="Copy results table to clipboard">
          Copy results
        </button>
        <button class="btn btn--primary" id="exportExcelBtnTop" type="button" title="Export results to Excel">
          Export Excel
        </button>
      </div>
    </header>

    <div class="shell">
      <aside class="sidebar" aria-label="Primary">
        <nav class="nav">
          <button class="tab-btn is-active" type="button" data-tab="home" id="tabBtnHome">
            <span class="tab-btn__icon" aria-hidden="true">üè†</span>
            <span class="tab-btn__text">Home</span>
          </button>
          <button class="tab-btn" type="button" data-tab="data" id="tabBtnData">
            <span class="tab-btn__icon" aria-hidden="true">üìÑ</span>
            <span class="tab-btn__text">Data</span>
          </button>
          <button class="tab-btn" type="button" data-tab="config" id="tabBtnConfig">
            <span class="tab-btn__icon" aria-hidden="true">‚öôÔ∏è</span>
            <span class="tab-btn__text">Settings</span>
          </button>
          <button class="tab-btn" type="button" data-tab="results" id="tabBtnResults">
            <span class="tab-btn__icon" aria-hidden="true">üìä</span>
            <span class="tab-btn__text">Results</span>
          </button>
          <button class="tab-btn" type="button" data-tab="sensitivity" id="tabBtnSensitivity">
            <span class="tab-btn__icon" aria-hidden="true">üß™</span>
            <span class="tab-btn__text">Sensitivity</span>
          </button>
          <button class="tab-btn" type="button" data-tab="export" id="tabBtnExport">
            <span class="tab-btn__icon" aria-hidden="true">üì¶</span>
            <span class="tab-btn__text">Export</span>
          </button>
          <button class="tab-btn" type="button" data-tab="help" id="tabBtnHelp">
            <span class="tab-btn__icon" aria-hidden="true">‚ùì</span>
            <span class="tab-btn__text">Help</span>
          </button>
        </nav>

        <div class="sidebar__footer">
          <div class="mini">
            <div class="mini__label">Scenario</div>
            <select id="scenarioSelect" class="input" aria-label="Select scenario">
              <!-- app.js populates -->
            </select>
          </div>

          <div class="mini">
            <div class="mini__label">Quick actions</div>
            <div class="stack stack--xs">
              <button class="btn btn--soft" id="recalcBtn" type="button">Recalculate</button>
              <button class="btn btn--soft" id="resetBtn" type="button">Reset</button>
            </div>
          </div>

          <div class="status" role="status" aria-live="polite">
            <span id="statusBar">Ready.</span>
          </div>
        </div>
      </aside>

      <main id="main" class="main" tabindex="-1">
        <!-- HOME -->
        <section class="tab-panel is-active" data-tab-panel="home" id="tab-home">
          <div class="panel">
            <div class="panel__head">
              <h1 class="h1">Snapshot view</h1>
              <p class="muted">
                The Results tab shows a vertical comparison table where rows are economic indicators and columns are
                the control and each treatment. Use Data to upload Excel and Settings to adjust discounting.
              </p>
            </div>

            <div class="grid grid--2">
              <div class="card">
                <h2 class="h2">Excel-first workflow</h2>
                <ol class="steps">
                  <li>Download the Excel template.</li>
                  <li>Fill or edit your treatments and time-series inputs.</li>
                  <li>Upload the Excel file back into the tool.</li>
                  <li>Check validation messages and view results.</li>
                </ol>
                <div class="stack">
                  <button class="btn btn--primary" id="downloadTemplateBtn" type="button">Download template (Excel)</button>
                  <div class="row row--gap">
                    <input id="uploadExcelInput" class="file" type="file" accept=".xlsx,.xls" />
                    <button class="btn btn--soft" id="uploadExcelBtn" type="button">Upload Excel</button>
                  </div>
                  <div id="validationSummary" class="callout callout--info" hidden></div>
                </div>
              </div>

              <div class="card">
                <h2 class="h2">What you will see</h2>
                <ul class="bullets">
                  <li><strong>NPV</strong> = PV benefits ‚àí PV costs</li>
                  <li><strong>PV benefits</strong> and <strong>PV costs</strong> are discounted sums over time</li>
                  <li><strong>BCR</strong> = PV benefits √∑ PV costs</li>
                  <li><strong>ROI</strong> = NPV √∑ PV costs</li>
                  <li><strong>Ranking</strong> compares treatments (control is shown alongside)</li>
                </ul>
                <div class="divider"></div>
                <div class="row row--gap">
                  <button class="btn btn--soft" id="goResultsBtn" type="button">Go to Results</button>
                  <button class="btn btn--ghost" id="goDataBtn" type="button">Go to Data</button>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- DATA -->
        <section class="tab-panel" data-tab-panel="data" id="tab-data">
          <div class="panel">
            <div class="panel__head">
              <h1 class="h1">Data</h1>
              <p class="muted">Upload Excel, preview parsed content, and check validation. All buttons are live.</p>
            </div>

            <div class="grid grid--2">
              <div class="card">
                <h2 class="h2">Upload / download</h2>
                <div class="stack">
                  <button class="btn btn--primary" id="downloadTemplateBtn2" type="button">Download template (Excel)</button>

                  <div class="row row--gap">
                    <input id="uploadExcelInput2" class="file" type="file" accept=".xlsx,.xls" />
                    <button class="btn btn--soft" id="uploadExcelBtn2" type="button">Upload Excel</button>
                  </div>

                  <div class="callout callout--warning" id="dataWarnings" hidden></div>
                  <div class="callout callout--success" id="dataOk" hidden></div>
                </div>
              </div>

              <div class="card">
                <h2 class="h2">Scenario-specific template</h2>
                <p class="muted">
                  If your app.js supports scenario templates, pick a scenario in the sidebar then download a pre-filled template.
                </p>
                <div class="row row--gap">
                  <button class="btn btn--soft" id="downloadScenarioTemplateBtn" type="button">
                    Download scenario template
                  </button>
                  <button class="btn btn--ghost" id="openMappingBtn" type="button">
                    View variable mapping
                  </button>
                </div>

                <div id="mappingModal" class="modal" hidden aria-hidden="true" role="dialog" aria-label="Variable mapping">
                  <div class="modal__backdrop" data-close-modal="mappingModal"></div>
                  <div class="modal__card">
                    <div class="modal__head">
                      <div>
                        <div class="h2">Excel mapping</div>
                        <div class="muted">Column names expected by the tool.</div>
                      </div>
                      <button class="icon-btn" type="button" data-close-modal="mappingModal" aria-label="Close">‚úï</button>
                    </div>
                    <div class="modal__body">
                      <div id="mappingTableWrap" class="table-wrap">
                        <table class="table" id="mappingTable" aria-label="Mapping table">
                          <thead>
                            <tr>
                              <th>Sheet</th>
                              <th>Column</th>
                              <th>Description</th>
                            </tr>
                          </thead>
                          <tbody>
                            <!-- app.js populates -->
                          </tbody>
                        </table>
                      </div>
                    </div>
                    <div class="modal__foot">
                      <button class="btn btn--soft" type="button" data-close-modal="mappingModal">Close</button>
                    </div>
                  </div>
                </div>

              </div>
            </div>

            <div class="card">
              <h2 class="h2">Preview</h2>
              <div class="table-wrap" id="dataPreviewWrap">
                <table class="table" id="dataPreviewTable" aria-label="Data preview table">
                  <thead>
                    <tr>
                      <th>Field</th>
                      <th>Value</th>
                      <th>Notes</th>
                    </tr>
                  </thead>
                  <tbody>
                    <!-- app.js populates -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </section>

        <!-- SETTINGS -->
        <section class="tab-panel" data-tab-panel="config" id="tab-config">
          <div class="panel">
            <div class="panel__head">
              <h1 class="h1">Settings</h1>
              <p class="muted">Discount rate, horizon, currency, and basic assumptions.</p>
            </div>

            <div class="grid grid--2">
              <div class="card">
                <h2 class="h2">Discounting</h2>
                <div class="form">
                  <label class="label" for="discountRateInput">Discount rate (%)</label>
                  <input id="discountRateInput" class="input" type="number" min="0" step="0.1" />

                  <label class="label" for="timeHorizonInput">Time horizon (years)</label>
                  <input id="timeHorizonInput" class="input" type="number" min="1" step="1" />

                  <label class="label" for="currencySelect">Currency</label>
                  <select id="currencySelect" class="input">
                    <option value="AUD">AUD</option>
                    <option value="USD">USD</option>
                    <option value="ETB">ETB</option>
                    <option value="EUR">EUR</option>
                    <option value="GBP">GBP</option>
                  </select>

                  <div class="row row--gap">
                    <button class="btn btn--primary" id="applyConfigBtn" type="button">Apply</button>
                    <button class="btn btn--ghost" id="resetConfigBtn" type="button">Reset settings</button>
                  </div>

                  <div class="callout callout--info" id="configNote">
                    Tip: After changing settings, go to Results and export to Excel for reporting.
                  </div>
                </div>
              </div>

              <div class="card">
                <h2 class="h2">Assumptions</h2>
                <div class="stack">
                  <div class="callout callout--warning" id="assumptionWarnings" hidden></div>
                  <div class="table-wrap">
                    <table class="table" id="assumptionsTable" aria-label="Assumptions table">
                      <thead>
                        <tr>
                          <th>Assumption</th>
                          <th>Value</th>
                          <th>Notes</th>
                        </tr>
                      </thead>
                      <tbody>
                        <!-- app.js populates -->
                      </tbody>
                    </table>
                  </div>
                  <div class="row row--gap">
                    <button class="btn btn--soft" id="editAssumptionsBtn" type="button">Edit assumptions</button>
                    <button class="btn btn--ghost" id="restoreAssumptionsBtn" type="button">Restore defaults</button>
                  </div>
                </div>
              </div>
            </div>

          </div>
        </section>

        <!-- RESULTS -->
        <section class="tab-panel" data-tab-panel="results" id="tab-results">
          <div class="panel">
            <div class="panel__head">
              <h1 class="h1">Results</h1>
              <p class="muted">
                Vertical comparison table: indicators (rows) vs control and treatments (columns). Use Export to download Excel
                or copy to Word.
              </p>
            </div>

            <div class="toolbar">
              <div class="toolbar__left">
                <div class="pill">
                  <span class="pill__label">Scenario:</span>
                  <span class="pill__value" id="scenarioLabel">‚Äî</span>
                </div>
                <div class="pill">
                  <span class="pill__label">Discount:</span>
                  <span class="pill__value" id="discountLabel">‚Äî</span>
                </div>
                <div class="pill">
                  <span class="pill__label">Horizon:</span>
                  <span class="pill__value" id="horizonLabel">‚Äî</span>
                </div>
              </div>

              <div class="toolbar__right">
                <button class="btn btn--soft" id="toggleDetailsBtn" type="button">Show details</button>
                <button class="btn btn--ghost" id="copyResultsBtn" type="button">Copy table</button>
                <button class="btn btn--primary" id="exportExcelBtn" type="button">Export Excel</button>
              </div>
            </div>

            <div class="card">
              <div class="table-wrap table-wrap--results" id="resultsTableWrap">
                <table class="table table--results" id="resultsTable" aria-label="Results comparison table">
                  <thead>
                    <tr id="resultsHeaderRow">
                      <!-- app.js populates -->
                      <th class="sticky-col">Indicator</th>
                      <th>Control</th>
                    </tr>
                  </thead>
                  <tbody id="resultsBody">
                    <!-- app.js populates -->
                  </tbody>
                </table>
              </div>

              <div class="note" id="resultsFootnote">
                Values are in present value terms unless stated otherwise. Ranking is computed within the selected scenario.
              </div>
            </div>

            <div class="card" id="detailsCard" hidden>
              <h2 class="h2">Details</h2>
              <div class="grid grid--2">
                <div class="table-wrap">
                  <table class="table" id="treatmentBreakdownTable" aria-label="Treatment breakdown">
                    <thead>
                      <tr>
                        <th>Treatment</th>
                        <th>PV benefits</th>
                        <th>PV costs</th>
                        <th>NPV</th>
                      </tr>
                    </thead>
                    <tbody><!-- app.js --></tbody>
                  </table>
                </div>
                <div class="callout callout--info" id="driversBox">
                  <!-- app.js -->
                </div>
              </div>
            </div>

          </div>
        </section>

        <!-- SENSITIVITY -->
        <section class="tab-panel" data-tab-panel="sensitivity" id="tab-sensitivity">
          <div class="panel">
            <div class="panel__head">
              <h1 class="h1">Sensitivity</h1>
              <p class="muted">Test how results change under alternative discount rates (and other options if enabled in app.js).</p>
            </div>

            <div class="card">
              <div class="grid grid--3">
                <div>
                  <label class="label" for="sensDiscountMin">Discount min (%)</label>
                  <input id="sensDiscountMin" class="input" type="number" min="0" step="0.1" />
                </div>
                <div>
                  <label class="label" for="sensDiscountMax">Discount max (%)</label>
                  <input id="sensDiscountMax" class="input" type="number" min="0" step="0.1" />
                </div>
                <div class="align-end">
                  <button class="btn btn--primary" id="runSensitivityBtn" type="button">Run sensitivity</button>
                </div>
              </div>

              <div class="divider"></div>

              <div class="table-wrap">
                <table class="table" id="sensTable" aria-label="Sensitivity results table">
                  <thead>
                    <tr>
                      <th>Discount</th>
                      <th>Best treatment</th>
                      <th>Control NPV</th>
                      <th>Best NPV</th>
                      <th>Notes</th>
                    </tr>
                  </thead>
                  <tbody><!-- app.js --></tbody>
                </table>
              </div>
            </div>
          </div>
        </section>

        <!-- EXPORT -->
        <section class="tab-panel" data-tab-panel="export" id="tab-export">
          <div class="panel">
            <div class="panel__head">
              <h1 class="h1">Export</h1>
              <p class="muted">Export Excel, copy-paste to Word, or download a Word-friendly HTML file.</p>
            </div>

            <div class="grid grid--2">
              <div class="card">
                <h2 class="h2">Excel</h2>
                <p class="muted">Creates a clean sheet suitable for sharing and archiving.</p>
                <button class="btn btn--primary" id="exportExcelBtn3" type="button">Export results to Excel</button>
              </div>

              <div class="card">
                <h2 class="h2">Word / reporting</h2>
                <p class="muted">Copy the results table to your clipboard or download a Word-friendly file.</p>
                <div class="stack">
                  <button class="btn btn--soft" id="copyResultsBtn2" type="button">Copy results table</button>
                  <button class="btn btn--ghost" id="exportWordBtn" type="button">Download Word-friendly HTML</button>
                </div>
              </div>
            </div>

            <div class="card">
              <h2 class="h2">Export log</h2>
              <div id="exportLog" class="log" aria-label="Export log"></div>
            </div>
          </div>
        </section>

        <!-- HELP -->
        <section class="tab-panel" data-tab-panel="help" id="tab-help">
          <div class="panel">
            <div class="panel__head">
              <h1 class="h1">Help</h1>
              <p class="muted">Quick troubleshooting for inactive buttons, data issues, and exports.</p>
            </div>

            <div class="card">
              <h2 class="h2">If something looks inactive</h2>
              <ul class="bullets">
                <li>Make sure <code>app.js</code> is loaded (check the browser console for errors).</li>
                <li>Open the Data tab and re-upload your Excel file.</li>
                <li>Click Recalculate in the sidebar.</li>
              </ul>

              <div class="divider"></div>

              <h2 class="h2">Definitions used in Results</h2>
              <div class="table-wrap">
                <table class="table" aria-label="Definitions table">
                  <thead>
                    <tr>
                      <th>Metric</th>
                      <th>Meaning</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr><td>NPV</td><td>PV benefits ‚àí PV costs</td></tr>
                    <tr><td>PV benefits</td><td>Discounted sum of benefits over time</td></tr>
                    <tr><td>PV costs</td><td>Discounted sum of costs over time</td></tr>
                    <tr><td>BCR</td><td>PV benefits √∑ PV costs</td></tr>
                    <tr><td>ROI</td><td>NPV √∑ PV costs</td></tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </section>
      </main>
    </div>

    <div id="toast" class="toast" hidden role="status" aria-live="polite"></div>
  </div>

  <!-- App script -->
  <script defer src="./app.js"></script>
</body>
</html>
